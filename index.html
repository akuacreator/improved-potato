<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Super Duper Disco ‚Äî AI Companion</title>
  <meta name="theme-color" content="#6b5bff" />
  <style>
    :root {
      --bg: #0f1021;
      --panel: #17182d;
      --text: #f5f7ff;
      --muted: #c7c9e1;
      --primary: #6b5bff;
      --accent: #ff69b4;
      --success: #28d99a;
      --danger: #ff4d6d;
      --radius: 14px;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      background: radial-gradient(1200px circle at 10% 10%, #151638, #0f1021);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "Ubuntu", Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
    .app-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 20px; background: rgba(23,24,45,0.7); backdrop-filter: blur(6px);
      border-bottom: 1px solid #23244a; position: sticky; top: 0; z-index: 10;
    }
    .brand { display: flex; align-items: center; gap: 12px }
    .logo { font-size: 28px }
    .brand h1 { margin: 0 }
    .tagline { margin: 0; color: var(--muted); font-size: 14px }
    .actions { display: flex; gap: 8px }
    button, .ghost, .primary, .danger {
      border: none; border-radius: 999px; padding: 10px 14px; cursor: pointer;
      background: #23244a; color: var(--text);
    }
    button.primary { background: var(--primary) }
    button.ghost { background: #23244a }
    button.danger { background: var(--danger) }
    button:disabled { opacity: 0.6; cursor: not-allowed }
    .chat {
      max-width: 880px; margin: 0 auto; padding: 14px; display: grid; gap: 12px;
    }
    .msg {
      display: grid; gap: 6px; padding: 12px 14px; border-radius: var(--radius);
      background: var(--panel); border: 1px solid #23244a;
    }
    .msg.user { border-left: 4px solid var(--accent) }
    .msg.ai { border-left: 4px solid var(--primary) }
    .msg .meta { color: var(--muted); font-size: 12px }
    .msg .text { line-height: 1.55; white-space: pre-wrap }
    .composer {
      position: sticky; bottom: 0; background: rgba(23,24,45,0.75);
      backdrop-filter: blur(6px); padding: 10px 14px; border-top: 1px solid #23244a;
    }
    .input-row { display: grid; grid-template-columns: 1fr auto; gap: 8px }
    textarea {
      width: 100%; resize: vertical; min-height: 44px; max-height: 160px;
      background: #12132a; color: var(--text); border: 1px solid #23244a; border-radius: var(--radius);
      padding: 10px 12px;
    }
    .hint { color: var(--muted); font-size: 12px; margin-top: 6px }
    dialog::backdrop { background: rgba(0,0,0,0.45) }
    .settings { width: 520px; max-width: 96vw }
    .settings h2, .settings h3 { margin: 6px 0 8px }
    .settings section { background: var(--panel); padding: 12px; border-radius: var(--radius); margin: 8px 0 }
    .settings .row { display: grid; grid-template-columns: 1fr 2fr; align-items: center; gap: 8px }
    .settings .small { color: var(--muted); font-size: 12px }
    menu { display: flex; justify-content: space-between; margin-top: 8px }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">ü™©</span>
      <div>
        <h1>Super Duper Disco</h1>
        <p class="tagline">Your kind, clever, creative AI companion</p>
      </div>
    </div>
    <nav class="actions">
      <button id="newChatBtn" class="ghost">New chat</button>
      <button id="exportBtn" class="ghost">Export</button>
      <button id="importBtn" class="ghost">Import</button>
      <button id="settingsBtn" class="ghost">Settings</button>
    </nav>
  </header>

  <main id="chat" class="chat"></main>

  <footer class="composer">
    <div class="input-row">
      <textarea id="prompt" rows="2" placeholder="Say what's on your mind‚Ä¶"></textarea>
      <button id="sendBtn" class="primary">Send</button>
    </div>
    <div class="hint">Tip: Try ‚Äúbrainstorm game ideas‚Äù or ‚Äúhelp me write a README‚Äù.</div>
  </footer>

  <dialog id="settingsDialog">
    <form method="dialog" class="settings">
      <h2>Settings</h2>
      <section>
        <label class="row">
          <span>Persona</span>
          <select id="personaSelect">
            <option value="coach">Coach ‚Äî direct, encouraging, practical</option>
            <option value="muse">Muse ‚Äî playful, imaginative, original</option>
            <option value="sage">Sage ‚Äî concise, structured, clear</option>
          </select>
        </label>
        <label class="row">
          <span>Tone</span>
          <select id="toneSelect">
            <option value="warm">Warm</option>
            <option value="neutral">Neutral</option>
            <option value="bold">Bold</option>
          </select>
        </label>
        <label class="row">
          <span>Memory (on this device)</span>
          <input type="checkbox" id="memoryToggle" checked />
        </label>
        <label class="row">
          <span>Theme color</span>
          <input type="color" id="themeColor" value="#6b5bff" />
        </label>
      </section>

      <section>
        <h3>Optional cloud LLM</h3>
        <p class="small">If you add an API key, replies will blend your local companion with a cloud LLM for deeper answers.</p>
        <label class="row">
          <span>Provider</span>
          <select id="llmProvider">
            <option value="">None (local only)</option>
            <option value="openai">OpenAI (gpt-4o-mini)</option>
            <option value="openrouter">OpenRouter</option>
          </select>
        </label>
        <label class="row">
          <span>API key</span>
          <input type="password" id="apiKey" placeholder="sk-‚Ä¶ (stored locally)" />
        </label>
      </section>

      <menu>
        <button id="resetBtn" class="danger">Reset app</button>
        <button value="cancel" class="ghost">Close</button>
      </menu>
    </form>
  </dialog>

  <script>
    // ---------- PLUGINS ----------
    const DiscoPlugins = [
      {
        id: "brainstorm",
        label: "Brainstorm",
        match: (prompt) => /brainstorm|ideas|concepts|pitch|theme/i.test(prompt),
        run: async ({ prompt, persona }) => {
          const topics = prompt.replace(/brainstorm/gi, "").trim() || "creative project";
          const styles = {
            coach: ["Action steps", "Audience", "Risks", "MVP"],
            muse: ["Wild twist", "Aesthetic", "Vibe", "Hook"],
            sage: ["Problem", "Solution", "Why now", "Measure"]
          }[persona];
          return [
            `Here are 6 fresh angles for ${topics}:`,
            ...["Community challenge","Micro-product","Narrative journey","Tool-with-a-heart","Festival drop","Collab remix"]
              .map((idea, i) => `- ${i+1}. ${idea}`),
            "",
            `Focus lenses: ${styles.join(", ")}`
          ].join("\\n");
        }
      },
      {
        id: "quiz-helper",
        label: "Quiz helper",
        match: (prompt) => /quiz|study|practice|test/i.test(prompt),
        run: async ({ prompt }) => {
          return [
            "Quick study routine:",
            "- 1. Read the concept in your own words.",
            "- 2. Write a tiny example.",
            "- 3. Explain it to an imaginary friend.",
            "- 4. Do 3 practice questions.",
            "",
            "Ask me any topic and I‚Äôll generate practice questions."
          ].join("\\n");
